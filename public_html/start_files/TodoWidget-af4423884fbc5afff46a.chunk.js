(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{1443:function(t,e,i){"use strict";var s=i(985);i.n(s).a},1444:function(t,e,i){"use strict";var s=i(986);i.n(s).a},1445:function(t,e,i){"use strict";var s=i(987);i.n(s).a},1446:function(t,e,i){"use strict";var s=i(988);i.n(s).a},1835:function(t,e,i){"use strict";i.r(e);var s=i(9),o=i.n(s),a=i(3),n=i.n(a),d=i(68),r=i.n(d),l=i(8),c=i(517),u=i(1),h={name:"TodoItem",props:{todo:u.a.object.isRequired,widgetData:u.a.object.isRequired,isEditingState:u.a.bool.def(!1),isDisabled:u.a.bool.def(!1),value:u.a.string.def("")},data:function(){return{text:this.value}},methods:{emitEditTodo:function(t){var e=t.ignoreActive,i=void 0!==e&&e;this.$emit("editTodo",this.todo),!this.$refs.input||this.todo.active&&!i||this.$refs.input.select()},emitDeleteTodo:function(){this.$emit("deleteTodo",this.todo)},emitSaveData:function(){this.$emit("saveData")},emitToggleChecked:function(){this.$emit("toggleChecked",this.todo)},emitInput:function(){this.$emit("input",this.todo.t)},toggleContextMenu:function(t){var e=this;if(!(this.isDisabled||t.shiftKey||t.ctrlKey)){var i=[{id:"edit",name:this.widgetData.isPreviewMode?"Edit":this.$t("edit"),icon:"fa fa-pencil-square-o",clickHandler:function(t){t.stopPropagation(),t.preventDefault(),e.emitEditTodo({ignoreActive:!0}),e.$nextTick(function(){try{document.querySelector(".todo-widget__item_active").select()}catch(t){}})}},{id:"delete",name:this.widgetData.isPreviewMode?"Delete":this.$t("delete"),icon:"fa fa-trash-o",clickHandler:function(){return e.emitDeleteTodo()}}];this.$eventBus.$emit("toggle-contextmenu",{items:i,positionX:t.pageX,positionY:t.pageY,event:t})}}}},g=(i(1443),i(7)),f=Object(g.a)(h,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{class:["todo-item",{"todo-item_disabled":t.isDisabled,"todo-item_active":t.todo.active}],on:{click:t.emitEditTodo,contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleContextMenu(e)}}},[i("div",{staticClass:"todo-item__container"},[i("span",{staticClass:"todo-item__check",class:{"todo-item__check_active":t.todo.c},on:{click:function(e){return e.stopPropagation(),t.emitToggleChecked(e)}}},[i("i",{staticClass:"todo-item__check-icon fa fa-check"})]),t._v(" "),i("div",{staticClass:"todo-item__input-wrapper"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.todo.t,expression:"todo.t"}],ref:"input",class:["todo-item__item",{"todo-item__item_active":t.todo.active,"todo-item__item_completed":t.todo.c,"todo-item__item_editing todo-item__item_editing_one":t.todo.active,"todo-item__item_editing todo-item__item_editing_all":t.isEditingState}],attrs:{disabled:!!t.isDisabled&&"disabled"},domProps:{value:t.todo.t},on:{input:[function(e){e.target.composing||t.$set(t.todo,"t",e.target.value)},t.emitInput],focus:function(t){return t.target.select()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.emitSaveData(e)},paste:function(t){t.stopPropagation()}}}),t._v(" "),t.isDisabled?t._e():i("i",{staticClass:"todo-item__delete fa fa-trash",on:{click:function(e){return e.stopPropagation(),t.emitDeleteTodo(e)}}})])])])},[],!1,null,null,null).exports,v={name:"TodoAdder",components:{SvgStrokeIcon:i(23).a},props:{isEditingState:u.a.bool.def(!1),isEditingTodo:u.a.bool.def(!1),hasDarkTheme:u.a.bool.def(!1),widgetData:u.a.object.isRequired},data:function(){return{newTodo:"",isInlineAdd:!1}},created:function(){this.$eventBus.$on("focus-field",this.focusField),this.$eventBus.$on("save-data-outside",this.saveDataOutside)},beforeDestroy:function(){this.$eventBus.$off("focus-field",this.focusField),this.$eventBus.$off("save-data-outside",this.saveDataOutside)},methods:{saveDataOutside:function(){!this.widgetData.isPreviewMode&&this.isEditingTodo&&(this.isEditingTodo||this.isInlineAdd)&&(this.isInlineAdd=!1,this.newTodo="",this.emitSaveData())},emitSaveData:function(){this.$emit("saveData")},showAddTodoInput:function(){this.widgetData.isPreviewMode||(this.emitTodosInactive(),this.newTodo="",this.isInlineAdd=!0,this.focusField())},emitAddTodo:function(){if(!this.widgetData.isPreviewMode){if(""===this.newTodo)return this.focusField();this.$emit("addTodo",this.newTodo),this.newTodo="",this.focusField()}},emitTodosInactive:function(){this.$emit("setTodosInactive")},focusField:function(){var t=this;this.$nextTick(function(){return t.$refs.input.focus()})},clearInput:function(){this.newTodo=""}}},_=(i(1444),Object(g.a)(v,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"todo-adder",class:{"todo-adder_transparent":!t.isEditingState&&t.widgetData.settings&&void 0!==t.widgetData.settings._b,"todo-adder_dark":t.hasDarkTheme}},[i("div",{staticClass:"todo-adder__input-wrapper",on:{click:t.emitTodosInactive}},[i("div",{staticClass:"todo-adder__inputbox"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.newTodo,expression:"newTodo",modifiers:{trim:!0}}],ref:"input",staticClass:"todo-adder__input",attrs:{type:"text",placeholder:t.$t("widgets.gtasks.add_new_task")},domProps:{value:t.newTodo},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.emitAddTodo(e)},paste:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.newTodo=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),i("div",{staticClass:"todo-adder__buttons"},[i("div",{staticClass:"todo-adder__buttons-wrapper"},[t.newTodo.length?i("a",{staticClass:"todo-adder__button",attrs:{title:t.$t("clear")},on:{click:function(e){return e.stopPropagation(),t.clearInput(e)}}},[i("SvgStrokeIcon",{staticClass:"todo-adder__feather-icon",attrs:{icon:"x",options:{size:16}}})],1):t._e(),t._v(" "),i("a",{staticClass:"todo-adder__button",attrs:{title:t.$t("add")},on:{click:function(e){return e.stopPropagation(),t.emitAddTodo(e)}}},[i("SvgStrokeIcon",{staticClass:"todo-adder__feather-icon",attrs:{icon:"plus",options:{size:16}}})],1)])])])])},[],!1,null,null,null).exports),m=i(45),p=i.n(m),b={name:"TodoSubNavigation",components:{DropList:function(){return i.e(2).then(i.bind(null,1852))}},props:{tabs:u.a.arrayOf(u.a.shape({id:u.a.oneOfType([u.a.string,u.a.number]).isRequired,title:u.a.string.def(""),number:u.a.number.def(0)})),selectedTabId:u.a.oneOfType([u.a.string,u.a.number]).isRequired,onTabSelect:u.a.func.isRequired,isDark:u.a.bool.def(!1)},data:function(){return{isMenuVisible:!1,labels:[]}},computed:{hasHiddenLabels:function(){return this.hiddenLabels.length>0},hiddenLabels:function(){return this.labels.filter(function(t){return t.isHidden})},menuOptions:function(){return this.hiddenLabels.map(function(t){return{id:t.id,name:"".concat(t.title," (").concat(t.number,")"),value:t.id}})}},watch:{tabs:function(){this.mapLabels(),this.checkOverflow()}},mounted:function(){window.addEventListener("resize",p()(this.checkOverflow,100)),this.mapLabels(),this.$nextTick(this.checkOverflow)},beforeDestroy:function(){window.removeEventListener("resize",p()(this.checkOverflow,100))},methods:{checkOverflow:function(){var t=this;if(this.$refs.toggle){var e=this.$refs.toggle.getBoundingClientRect().left;this.labels.forEach(function(i,s){try{var o=t.$refs.labels[s].getBoundingClientRect().right;i.isHidden=o>=e}catch(a){}})}},isActive:function(t){return t.id===this.selectedTabId},mapLabels:function(){this.labels=this.tabs.map(function(t){return n()({},t,{isHidden:!0})})},toggleHiddenMenu:function(t){this.isMenuVisible=!this.isMenuVisible},selectLabel:function(t){this.onTabSelect(t.id),this.toggleHiddenMenu()}}},T=(i(1445),Object(g.a)(b,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("nav",{ref:"subheader",staticClass:"todo-sub-navigation",class:{"todo-sub-navigation_theme_dark":t.isDark}},[i("div",{staticClass:"todo-sub-navigation__wrapper"},[i("ul",{staticClass:"todo-sub-navigation__list"},t._l(t.labels,function(e){return i("li",{key:e.id,ref:"labels",refInFor:!0,staticClass:"todo-sub-navigation__label",class:{"todo-sub-navigation__label_active":t.isActive(e),"todo-sub-navigation__label_hidden":e.isHidden},on:{click:function(i){return t.onTabSelect(e.id,i)}}},[i("span",{staticClass:"todo-sub-navigation__text-container todo-sub-navigation__text-container_ellipsed"},[i("span",{staticClass:"todo-sub-navigation__text"},[t._v(t._s(e.title))])]),t._v(" "),i("span",{staticClass:"todo-sub-navigation__text-container todo-sub-navigation__text-container_fixed"},[t._v("\xa0("+t._s(e.number)+")")])])}),0),t._v(" "),i("span",{ref:"toggle",staticClass:"todo-sub-navigation__toggle",class:{"todo-sub-navigation__toggle_hidden":!t.hasHiddenLabels},on:{click:function(e){return e.stopPropagation(),t.toggleHiddenMenu(e)}}},[i("i",{staticClass:"todo-sub-navigation__icon fa fa-bars"})])]),t._v(" "),t.isMenuVisible?i("DropList",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.toggleHiddenMenu,expression:"toggleHiddenMenu"}],staticClass:"todo-sub-navigation__menu",attrs:{"active-item-id":t.selectedTabId,"click-handler":t.selectLabel,items:t.menuOptions}}):t._e()],1)},[],!1,null,null,null).exports),w=i(176),D={name:"TodoWidget",components:{BaseWidget:c.a,draggable:r.a,TodoItem:f,TodoAdder:_,TodoSubNavigation:T},mixins:[w.a],data:function(){return{icon:"",defaultIcon:"fa-tasks",newTodo:"",isInlineAdd:!1,isEditingTodo:!1,isDragging:!1,error:!1,showNotification:!1,help_article:"212080905-To-do-list",selectedTabId:0,preview:{title_phrase:"widgets.todo.new_widget_title"},allTodos:[{active:!1,c:!1,t:"Buy laptop"},{active:!1,c:!1,t:"Call Eline"},{active:!1,c:!0,t:"Get coffee"}]}},computed:n()({},Object(l.c)("page",["canEdit"]),{layeredContextMenuConfig:function(){var t=this,e={title:this.$t("general")},i=this.getWidgetActionsField(),s=i.items.find(function(t){return"edit"===t.id});s&&(s.label=this.$t("edit_todos"));var o=this.getLayeredContextMenuConfig(i);if(this.checkContext(this.contextMenuIds.DISPLAY_ID)){var a=[{id:"all",value:null,label:this.$t("widgets.todo.all_tasks")},{id:"open",value:1,label:this.$t("widgets.todo.open_tasks")},{id:"completed",value:2,label:this.$t("widgets.todo.completed_tasks")}],n=[[{label:this.$t("default_tab"),type:"oneRowRadio",vmodel:this.settings,vmodelField:"d_t",options:a,isWrapped:!0,inputChangeHandler:function(){t.saveSettings()}}]];o.push({headerTitle:this.$t("display_settings"),hasArrow:!0,listenHeader:!0,hasClose:!0,headerClickHandler:function(){t.removeContext(t.contextMenuIds.DISPLAY_ID)},tabs:[e],fields:n,activeTab:0})}return o},dndOptions:function(){var t={disabled:this.isTouch||this.isDisabled,group:"todos",handle:".todo-item:not(.todo-item_active)",ghostClass:"todo-item_ghost",fallbackClass:"todo-item_dragging",forceFallback:!1,fallbackTolerance:0};return this.$utils.isIPad()||(t.delay=300,t.delayOnTouchOnly=!0),t},isDisabled:function(){return!this.canEdit(this.$route)},subNavigationTabs:function(){return[{id:0,title:this.$t("widgets.todo.all_tasks_short"),number:this.allTodos.length},{id:1,title:this.$t("widgets.todo.open_tasks_short"),number:this.allTodos.length-this.completedTodos.length},{id:2,title:this.$t("widgets.todo.completed_tasks_short"),number:this.completedTodos.length}]},filteredTodos:{get:function(){return 1===this.selectedTabId?this.allTodos.filter(function(t){return!t.c}):2===this.selectedTabId?this.completedTodos:this.allTodos},set:function(t){var e=this;if(0!==this.selectedTabId){var i=[],s=o()(this.allTodos);s.forEach(function(t,s){(1===e.selectedTabId&&!t.c||2===e.selectedTabId&&t.c)&&i.push(s)}),i.length===t.length&&(t.forEach(function(t,e){s.splice(i[e],1,t)}),this.settings.t=s)}else this.settings.t=t}},editAll:function(){if(this.isEditingState)return this.setTodosActive()},isTouch:function(){return!this.$utils.canDragWithoutEditing()},hasTodos:function(){return this.allTodos.length>0},completedTodos:function(){return this.allTodos.filter(function(t){return t.c})}}),watch:{"settings.t":{immediate:!0,deep:!0,handler:function(t){this.setTodos(t)}}},created:function(){this.setTodosInactive(),this.presetActiveTab()},beforeDestroy:function(){clearTimeout(this.showNotification)},methods:{setTodos:function(t){this.widgetData.isPreviewMode||(this.allTodos=t||[])},settingsDefaults:function(){return{t:[]}},addTodo:function(t){this.widgetData.isPreviewMode||this.isDisabled||(this.settings.t||(this.settings.t=[]),this.settings.t.push({t:t,c:0,active:!1}),this.saveData())},editTodo:function(t){this.widgetData.isPreviewMode||this.isDisabled||(this.setTodosInactive(),t.active=!0,this.isEditingTodo=!0)},deleteTodo:function(t){if(!this.widgetData.isPreviewMode&&!this.isDisabled){var e=this.settings.t.indexOf(t);if(-1!==e)return this.settings.t.splice(e,1),void this.saveData();this.setError()}},deleteCompletedTodos:function(){this.isDisabled||(this.widgetData.settings.t=this.widgetData.settings.t.filter(function(t){return!t.c}),this.saveSettings())},toggleChecked:function(t){this.isDisabled||(t.c=!t.c,this.saveData(t))},saveData:function(t){var e=this;if(!this.widgetData.isPreviewMode&&!this.isDisabled){var i=this.$el.getElementsByClassName("todo-item__item_active")[0];i&&i.blur(),this.setTodosInactive(),this.saveSettings().catch(function(i){t&&(t.c=!t.c),e.setError()})}},emitSaveDataOutside:function(){this.widgetData.isPreviewMode||!this.isEditingTodo||this.isDisabled||this.$eventBus.$emit("save-data-outside")},setTodosInactive:function(){this.isEditingTodo=!1,this.allTodos.forEach(function(t){return t.active=!1})},setTodosActive:function(){this.isDisabled||(this.isEditingTodo=!0,this.allTodos.forEach(function(t){return t.active=!0}))},setError:function(){var t=this;this.clearError(),this.error=!0,this.showNotification=setTimeout(function(){t.error=!1},4e3)},clearError:function(){this.error=!1,clearTimeout(this.showNotification)},saveAfterDragging:function(){this.widgetData.isPreviewMode||this.saveSettings()},setTab:function(t){this.selectedTabId=t},presetActiveTab:function(){var t=this;if(this.settings){if(!this.settings.d_t)return this.settings.d_t=null,void this.setTab(0);this.subNavigationTabs.some(function(e){return e.id===t.settings.d_t})?this.setTab(this.settings.d_t):this.setTab(0)}else this.setTab(0)}}},k=(i(1446),Object(g.a)(D,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"todo-widget",class:{"todo-widget_theme_dark":t.isDark}},[i("BaseWidget",{attrs:{"widget-data":t.$props.widgetData}},[t.error?i("div",{staticClass:"todo-widget__error"},[i("p",{staticClass:"todo-widget__error-message"},[t._v(t._s(t.$t("internal_server_error")))])]):t._e(),t._v(" "),i("div",{staticClass:"todo-widget__wrapper"},[t.hasTodos?i("TodoSubNavigation",{attrs:{tabs:t.subNavigationTabs,"is-dark":(t.isDark||t.isDarkTheme)&&!t.widgetData.isPreviewMode,"selected-tab-id":t.selectedTabId,"on-tab-select":t.setTab}}):t._e(),t._v(" "),t.filteredTodos.length>0?i("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.emitSaveDataOutside,expression:"emitSaveDataOutside"}],staticClass:"todo-widget__list"},[i("draggable",t._b({staticClass:"todo-widget__drag-container",attrs:{tag:"ul"},on:{update:t.saveAfterDragging},model:{value:t.filteredTodos,callback:function(e){t.filteredTodos=e},expression:"filteredTodos"}},"draggable",t.dndOptions,!1),t._l(t.filteredTodos,function(e,s){return i("TodoItem",{key:"todo_"+s,attrs:{todo:e,"widget-data":t.widgetData,"is-editing-state":t.isEditingState,"is-disabled":t.isDisabled},on:{editTodo:t.editTodo,deleteTodo:t.deleteTodo,toggleChecked:t.toggleChecked,saveData:function(e){return t.saveData(null)}},model:{value:e.t,callback:function(i){t.$set(e,"t",i)},expression:"todo.t"}})}),1)],1):i("div",{staticClass:"todo-widget__stub"},[i("span",{staticClass:"todo-widget__text"},[t._v(t._s(t.$t("widgets.gtasks.no_tasks")))])]),t._v(" "),t.isDisabled?t._e():i("div",{staticClass:"todo-widget__adder"},[i("TodoAdder",{attrs:{"is-editing-state":t.isEditingState,"widget-data":t.widgetData,"is-editing-todo":t.isEditingTodo,"has-dark-theme":t.isDark},on:{addTodo:t.addTodo,setTodosInactive:t.setTodosInactive,saveData:function(e){return t.saveData(null)}}})],1),t._v(" "),t.isEditingState&&t.completedTodos.length>0?i("div",{staticClass:"todo-widget__delete-bar",on:{click:function(e){return e.stopPropagation(),t.deleteCompletedTodos(e)}}},[i("i",{staticClass:"todo-widget__icon fa fa-trash"}),t._v(" "),i("span",{staticClass:"todo-widget__text"},[t._v("\n          "+t._s(t.$t("widgets.todo.delete_all_completed",{total:t.completedTodos.length}))+"\n        ")])]):t._e()],1)])],1)},[],!1,null,null,null));e.default=k.exports},985:function(t,e,i){},986:function(t,e,i){},987:function(t,e,i){},988:function(t,e,i){}}]);